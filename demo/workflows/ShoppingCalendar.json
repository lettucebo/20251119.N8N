{
  "name": "ShoppingCalendar",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        0,
        80
      ],
      "id": "ba1b1125-aaa5-4494-8653-982627e8b680",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "resource": "worksheet",
        "operation": "readRows",
        "workbook": {
          "__rl": true,
          "value": "9FBB0DE07F2BDB9D!s230bc0dd71bd43c8a72825f046562e9e",
          "mode": "id"
        },
        "worksheet": {
          "__rl": true,
          "value": "{00000000-0001-0000-0000-000000000000}",
          "mode": "list",
          "cachedResultName": "åœ˜è³¼æ¸…å–®",
          "cachedResultUrl": "https://onedrive.live.com/personal/9fbb0de07f2bdb9d/_layouts/15/doc.aspx?resid=230bc0dd-71bd-43c8-a728-25f046562e9e&cid=9fbb0de07f2bdb9d&activeCell=%E5%9C%98%E8%B3%BC%E6%B8%85%E5%96%AE!A1"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.microsoftExcel",
      "typeVersion": 2.2,
      "position": [
        224,
        80
      ],
      "id": "0d74cd2e-6770-46eb-b639-d07a8fdbc22c",
      "name": "Get rows from sheet",
      "credentials": {
        "microsoftExcelOAuth2Api": {
          "id": "t4EEDYFz8RPrZt8m",
          "name": "Microsoft Excel account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        448,
        80
      ],
      "id": "8fa2506a-5117-4ac3-ba14-445c946d14ef",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "jsCode": "// N8N Code ç¯€é»ï¼šè™•ç†åœ˜è³¼è³‡æ–™ä¸¦æº–å‚™å»ºç«‹ Google æ—¥æ›†äº‹ä»¶\n// ç¯€é»åç¨±ï¼šProcess Group Buying Data\n\n// å–å¾—æ‰€æœ‰è¼¸å…¥çš„è³‡æ–™é …ç›®\nconst items = $input.all();\n\n// æº–å‚™è¼¸å‡ºé™£åˆ—\nconst processedEvents = [];\n\n// è™•ç†æ¯ä¸€ç­†åœ˜è³¼è³‡æ–™\nfor (const item of items) {\n  const data = item.json;\n  \n  // 1. é©—è­‰å¿…è¦æ¬„ä½\n  if (!data.åœ˜è³¼åç¨± || !data.é–‹åœ˜æ—¥æœŸ) {\n    console.log(`è·³éç„¡æ•ˆè³‡æ–™: ${JSON.stringify(data)}`);\n    continue; // è·³éæ²’æœ‰åç¨±æˆ–æ—¥æœŸçš„è³‡æ–™\n  }\n  \n  // 2. çµ„åˆå®Œæ•´çš„æ—¥æœŸæ™‚é–“\n  const startDate = data.é–‹åœ˜æ—¥æœŸ; // æ ¼å¼: 2025-11-21\n  const endDate = data.çµæŸæ—¥æœŸ || data.é–‹åœ˜æ—¥æœŸ; // å¦‚æœæ²’æœ‰çµæŸæ—¥æœŸï¼Œä½¿ç”¨é–‹åœ˜æ—¥æœŸ\n  const startTime = data.é–‹åœ˜æ™‚é–“ || '09:00'; // é è¨­ 09:00\n  const endTime = data.çµæŸæ™‚é–“ || '18:00'; // é è¨­ 18:00\n  \n  // çµ„åˆæˆ ISO 8601 æ ¼å¼\n  const startDateTime = `${startDate}T${startTime}:00+08:00`; // å°ç£æ™‚å€ UTC+8\n  const endDateTime = `${endDate}T${endTime}:00+08:00`;\n  \n  // 3. å»ºç«‹äº‹ä»¶æè¿°ï¼ˆåŒ…å«æ‰€æœ‰è©³ç´°è³‡è¨Šï¼‰\n  const description = `\nğŸ“ åœ°é»ï¼š${data.åœ°é» || 'æœªæŒ‡å®š'}\nğŸ‘¤ è² è²¬äººï¼š${data.è² è²¬äºº || 'æœªæŒ‡å®š'}\nğŸ“ è¯çµ¡é›»è©±ï¼š${data.è¯çµ¡é›»è©± || 'æœªæä¾›'}\nğŸ’° é ä¼°é‡‘é¡ï¼šNT$ ${data.é ä¼°é‡‘é¡ || '0'}\n\nğŸ“ å‚™è¨»ï¼š\n${data.å‚™è¨» || 'ç„¡'}\n\n---\nğŸ¤– æ­¤æ´»å‹•ç”± N8N è‡ªå‹•å»ºç«‹\nâ° åŒ¯å…¥æ™‚é–“ï¼š${new Date().toLocaleString('zh-TW', { timeZone: 'Asia/Taipei' })}\n  `.trim();\n  \n  // 4. å»ºç«‹äº‹ä»¶ç‰©ä»¶\n  const event = {\n    // Google Calendar éœ€è¦çš„æ¬„ä½\n    summary: data.åœ˜è³¼åç¨±, // äº‹ä»¶æ¨™é¡Œ\n    description: description, // äº‹ä»¶æè¿°\n    location: data.åœ°é» || '', // åœ°é»\n    startDateTime: startDateTime, // é–‹å§‹æ™‚é–“\n    endDateTime: endDateTime, // çµæŸæ™‚é–“\n    \n    // äº‹ä»¶é¡è‰² (Google Calendar é¡è‰² ID)\n    // 1=æ·¡ç´«, 2=æ·¡ç¶ , 3=ç´«è‰², 4=ç²‰ç´…, 5=é»ƒè‰², 6=æ©˜è‰², 7=é’è‰², 8=ç°è‰², 9=è—è‰², 10=ç¶ è‰², 11=ç´…è‰²\n    colorId: '9', // è—è‰²\n    \n    // æé†’è¨­å®š\n    reminders: {\n      useDefault: false,\n      overrides: [\n        { method: 'popup', minutes: 1440 }, // æå‰ 1 å¤©æé†’\n        { method: 'popup', minutes: 60 },   // æå‰ 1 å°æ™‚æé†’\n      ]\n    },\n    \n    // è‡ªè¨‚å±¬æ€§ï¼ˆç”¨æ–¼è¿½è¹¤å’Œå»é‡ï¼‰\n    extendedProperties: {\n      private: {\n        source: 'onedrive_excel',\n        importDate: new Date().toISOString(),\n        responsiblePerson: data.è² è²¬äºº || '',\n        estimatedAmount: data.é ä¼°é‡‘é¡ || ''\n      }\n    },\n    \n    // ä¿ç•™åŸå§‹è³‡æ–™ï¼ˆæ–¹ä¾¿é™¤éŒ¯ï¼‰\n    _originalData: data\n  };\n  \n  // 5. åŠ å…¥åˆ°è¼¸å‡ºé™£åˆ—\n  processedEvents.push({\n    json: event,\n    pairedItem: { item: item.pairedItem?.item || 0 }\n  });\n}\n\n// è¼¸å‡ºè™•ç†å¾Œçš„è³‡æ–™\nconsole.log(`æˆåŠŸè™•ç† ${processedEvents.length} ç­†åœ˜è³¼è³‡æ–™`);\nreturn processedEvents;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        672,
        0
      ],
      "id": "d2e374bb-1471-4775-9a13-6bbfe0acabe7",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "calendar": {
          "__rl": true,
          "value": "abc12207@gmail.com",
          "mode": "list",
          "cachedResultName": "abc12207@gmail.com"
        },
        "start": "={{ $json.startDateTime }}",
        "end": "={{ $json.endDateTime }}",
        "additionalFields": {
          "allday": "no",
          "color": "={{ $json.colorId }}",
          "description": "={{ $json.description }}",
          "location": "={{ $json.location }}",
          "summary": "={{ $json.summary }}"
        }
      },
      "type": "n8n-nodes-base.googleCalendar",
      "typeVersion": 1.3,
      "position": [
        896,
        80
      ],
      "id": "a184f8b8-09c4-4198-a403-20188b6c1fe3",
      "name": "Create an event",
      "credentials": {
        "googleCalendarOAuth2Api": {
          "id": "DdbVuHDGF2TzRIPI",
          "name": "Google Calendar account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "Get rows from sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get rows from sheet": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Create an event",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create an event": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "a136f344-907c-400d-af45-05cb765d31dc",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "cbf1298add127fa0204a2766dba48f09cc5f0b2f67e3a4a206fcf84365083c37"
  },
  "id": "1ocyjZR4RZSpPHGP",
  "tags": []
}